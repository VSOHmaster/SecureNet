# SecureNet

SecureNet - это инструмент для мониторинга сети и анализа безопасности, использующий агентную архитектуру и веб-интерфейс. Он позволяет обнаруживать устройства в локальных сетях, определять производителя по MAC-адресу, отслеживать статус агентов, управлять устройствами, получать оповещения и просматривать базовую аналитику.

## Возможности

*   **Веб-интерфейс:** Управление агентами, просмотр и управление обнаруженными устройствами (статус, заметки), просмотр оповещений, аналитики и настройка параметров через веб-браузер. Создан с использованием FastAPI и Jinja2.
*   **Управление агентами:** Добавление (с генерацией API ключа), удаление, просмотр статуса (активен/неактивен) и времени последней активности агентов мониторинга.
*   **Обнаружение устройств:** Использует агент ARP-сканирования (на основе Scapy) для обнаружения устройств в сегментах сети, отслеживаемых агентами.
*   **Управление устройствами:** Просмотр списка активных и всех когда-либо виденных устройств. Возможность изменять статус устройства (`trusted`, `untrusted`, `blocked`), добавлять заметки/имена и удалять устройства.
*   **OUI Lookup:** Автоматически определяет производителя обнаруженных устройств по их MAC-адресу с использованием базы данных IEEE OUI. Возможность ручного обновления базы OUI через UI и `manage.py`.
*   **Оповещения:** Генерирует оповещения об обнаружении новых, недоверенных или заблокированных устройств, а также об изменении статуса агентов (неактивен/активен). Настраиваемый порог серьезности и кулдаун для повторных оповещений.
*   **Аналитика:** Графики динамики количества активных устройств и числа оповещений (Info, Warning, High/Critical) за выбранный период (6/12/24 часа).
*   **Настройки:** Конфигурация системных параметров (интервалы, таймауты, CIDR по умолчанию, URL OUI), настроек уведомлений (метод, порог, кулдаун), параметров Telegram и Email.
*   **Конфигурация Агентов:** Агенты Scapy запрашивают свою конфигурацию (интервал, таймаут, CIDR) с сервера по API, используя URL сервера, переданный при запуске. Агенты периодически проверяют обновления конфигурации.
*   **Аутентификация:** Система безопасного входа (имя пользователя/пароль) для доступа к веб-интерфейсу с использованием сессионных cookie.
*   **Управление:** CLI-инструмент (`manage.py`) для инициализации БД, создания администратора и обновления OUI.
*   **Симуляция агента:** Включает простой симулятор агента для тестирования серверной конечной точки.
*   **Docker Поддержка:** Возможность запуска сервера, базы данных и агента с использованием Docker и Docker Compose.

## Установка и Настройка (Ручная)

### Предварительные Требования (Ручная установка)

*   **Python:** Рекомендуется версия 3.9+.
*   **pip:** Установщик пакетов Python.
*   **База данных:** Рекомендуется PostgreSQL (из-за `psycopg2-binary`). Вам понадобится запущенный сервер PostgreSQL. Другие СУБД, совместимые с SQLAlchemy, могут работать при смене драйвера и строки подключения.
*   **libpcap/Npcap (для Scapy Агента):**
    *   **Linux (Debian/Ubuntu):** `sudo apt update && sudo apt install libpcap-dev python3-dev`
    *   **Linux (Fedora/CentOS):** `sudo dnf install libpcap-devel python3-devel`
    *   **macOS:** Обычно входит в состав Xcode Command Line Tools. Если нужно: `xcode-select --install`.
    *   **Windows:** Установите [Npcap](https://npcap.com/) (выберите "Install Npcap in WinPcap API-compatible Mode" во время установки). **Важно для работы Scapy под Windows.**

### Настройка Сервера (Ручная)

1.  **Клонировать Репозиторий:**
    ```bash
    git clone <repository_url>
    cd SecureNet
    ```

2.  **Перейти в Директорию Сервера:**
    ```bash
    cd server
    ```

3.  **Создать Виртуальное Окружение:** (Рекомендуется)
    ```bash
    python -m venv venv
    # Активировать окружение
    # Linux/macOS:
    source venv/bin/activate
    # Windows (cmd):
    venv\Scripts\activate
    # Windows (PowerShell):
    .\venv\Scripts\Activate.ps1
    ```

4.  **Установить Зависимости Сервера:**
    ```bash
    pip install -r requirements.txt
    ```

5.  **Создать Файл `server/.env`:**
    Создайте файл с именем `.env` внутри папки `server/` со следующим содержимым. **Замените значения-заполнители!**

    ```dotenv
    # Пример файла server/.env (для приложения сервера, ручная установка)

    # Строка подключения к базе данных (измените для вашего типа БД/учетных данных)
    # Пример для PostgreSQL:
    DATABASE_URL=postgresql+psycopg2://user:password@host:port/database_name
    # Пример для SQLite (для тестирования, не рекомендуется для продакшена):
    # DATABASE_URL=sqlite:///./data/securenet.db

    # КРИТИЧНО: Сгенерируйте надежный случайный секретный ключ для безопасности сессий
    # Используйте в терминале: python -c 'import secrets; print(secrets.token_hex(32))'
    SECRET_KEY=your_strong_random_secret_key_here

    # Опционально: можно переопределить URL для OUI или таймаут устройства здесь,
    # но рекомендуется делать это через веб-интерфейс Настроек.
    # OUI_FILE_URL=https://standards-oui.ieee.org/oui/oui.txt
    # DEVICE_ACTIVITY_TIMEOUT_MINUTES=60
    ```
    *   **`DATABASE_URL`:** Обновите реальными данными для подключения к вашей БД. Если используете SQLite, убедитесь, что папка `server/data/` существует.
    *   **`SECRET_KEY`:** Сгенерируйте безопасный ключ, как указано в комментариях. **Не используйте ключ по умолчанию.** Это критично для безопасности аутентификации.

6.  **Инициализировать Базу Данных:**
    Запустите скрипт управления из *корневой* директории проекта (`SecureNet/`).
    ```bash
    cd .. # Вернуться в корневую папку SecureNet/, если вы были в server/
    python manage.py init-db
    ```
    Это создаст необходимые таблицы в вашей базе данных.

7.  **Создать Администратора:**
    ```bash
    python manage.py create-admin
    ```
    Следуйте инструкциям для установки имени пользователя и пароля первого администратора.

8.  **Загрузить Данные OUI:**
    ```bash
    python manage.py update-oui
    ```
    Это загрузит базу данных производителей по MAC-адресам из интернета. Может занять минуту. Файл будет сохранен в `server/data/oui.txt`.

### Настройка Агента (Ручная)

1.  **Перейти в Директорию Агента:**
    ```bash
    # Предполагая, что вы находитесь в корневой директории SecureNet/
    cd agent
    ```

2.  **Создать Виртуальное Окружение:** (Опционально, но рекомендуется, если запускаете на другой машине)
    ```bash
    python -m venv venv
    # Активировать (см. Шаг 3 Настройки Сервера для команд)
    source venv/bin/activate
    ```

3.  **Установить Зависимости Агента:**
    ```bash
    pip install -r requirements.txt
    ```

## Запуск Приложения (Ручной)

1.  **Запустить Сервер:**
    *   Убедитесь, что вы находитесь в директории `SecureNet/server/`.
    *   Убедитесь, что виртуальное окружение сервера активировано.
    *   Запустите с помощью Uvicorn:
        ```bash
        uvicorn server.main:app --reload --host 0.0.0.0 --port 8000
        ```
        *   `--reload`: Автоматически перезапускает сервер при изменении кода (удобно для разработки).
        *   `--host 0.0.0.0`: Делает сервер доступным с других машин в вашей сети (используйте IP сервера для доступа).
        *   `--port 8000`: Указывает порт для прослушивания.

    *   Откройте веб-интерфейс по адресу `http://<IP_адрес_вашего_сервера>:8000`.

2.  **Запустить Агент Scapy:**
    *   Войдите в веб-интерфейс (`http://<IP_адрес_вашего_сервера>:8000`).
    *   Перейдите на страницу "Агенты".
    *   Нажмите "Добавить агента", введите имя (например, "LAN Scanner 1 этаж") и нажмите "Добавить".
    *   **Немедленно скопируйте сгенерированный API ключ!** Он больше не будет показан в интерфейсе.
    *   Перейдите в директорию `SecureNet/agent/` на машине, где вы хотите запустить сканер (эта машина должна быть в сканируемой сети).
    *   Убедитесь, что виртуальное окружение агента активировано (если используется).
    *   Запустите скрипт агента, передав ему **API ключ** и **URL сервера**:
        ```bash
        # Linux/macOS (Требует root/sudo для сканирования сети)
        sudo python scapy_agent.py <ВАШ_СКОПИРОВАННЫЙ_API_КЛЮЧ> <URL_СЕРВЕРА> [ВАША_СЕТЬ_CIDR]

        # Windows (Требует прав Администратора)
        # Откройте PowerShell или CMD от имени Администратора
        python scapy_agent.py <ВАШ_СКОПИРОВАННЫЙ_API_КЛЮЧ> <URL_СЕРВЕРА> [ВАША_СЕТЬ_CIDR]
        ```
        *   Замените `<ВАШ_СКОПИРОВАННЫЙ_API_КЛЮЧ>` на ключ, полученный из веб-интерфейса.
        *   Замените `<URL_СЕРВЕРА>` на *базовый* URL вашего сервера SecureNet (например, `http://192.168.1.100:8000` или `http://localhost:8000`, если агент и сервер на одной машине). **Это обязательный аргумент.**
        *   `[ВАША_СЕТЬ_CIDR]` (например, `"192.168.1.0/24"`) - **необязательный** аргумент. Если он указан, агент будет использовать его *до* получения конфигурации с сервера. После получения конфигурации с сервера, будет использоваться CIDR из настроек сервера. Если аргумент не указан, агент запросит конфигурацию с сервера и будет использовать CIDR оттуда (или значение по умолчанию, если сервер его не задаст).
        *   **Права доступа:** Scapy нужен доступ к сырым сокетам для ARP-сканирования. Запускайте с `sudo` на Linux/macOS или от имени Администратора на Windows. Убедитесь, что `libpcap`/`Npcap` установлен.

3.  **Запустить Симулятор Агента (Опционально для Тестирования):**
    *   Получите API ключ, как описано для Scapy Агента (шаги добавления агента в UI).
    *   Перейдите в директорию `SecureNet/agent/`.
    *   Запустите симулятор:
        ```bash
        python simulate_agent.py <ВАШ_API_КЛЮЧ_СЮДА>
        ```
        Симулятор не выполняет реальное сканирование, а просто отправляет тестовые данные на сервер. Права администратора не требуются. URL сервера для симулятора жестко задан в коде (`http://127.0.0.1:8000/api/agent/report`).

---

## Установка и Запуск с помощью Docker

Этот метод рекомендуется для упрощения развертывания и управления зависимостями.

### Предварительные Требования (Docker)

*   **Docker:** Установленная и запущенная среда Docker. [Инструкции по установке Docker](https://docs.docker.com/engine/install/).
*   **Docker Compose:** Установленный инструмент для определения и запуска многоконтейнерных Docker-приложений. Обычно устанавливается вместе с Docker Desktop, но может потребоваться отдельная установка на Linux. [Инструкции по установке Docker Compose](https://docs.docker.com/compose/install/).

### Настройка (Docker)

1.  **Клонировать Репозиторий:**
    ```bash
    git clone <repository_url>
    cd SecureNet
    ```

2.  **Настроить Файлы Конфигурации:**
    Вам понадобятся **два** файла с переменными окружения:
    *   **`.env` (в корне проекта):** Создайте этот файл рядом с `docker-compose.yml`. Он будет использоваться для подстановки значений в `docker-compose.yml`.
    *   **`server/.env`:** Создайте этот файл внутри папки `server/`. Он будет использоваться непосредственно приложением сервера.

    **Пример содержимого файла `.env` (в корне проекта):**

    ```dotenv
    # .env (для Docker Compose, в корне проекта)

    # Переменные для базы данных (переопределяют значения по умолчанию в docker-compose.yml)
    POSTGRES_USER=securenet_user
    POSTGRES_PASSWORD=YourStrongPasswordHere # Замените на ваш надежный пароль
    POSTGRES_DB=securenet_db

    # Порт сервера (переопределяет порт по умолчанию 8000)
    # SERVER_PORT=8001

    # --- Переменные для АГЕНТА (если запускаете через docker-compose) ---
    # ОБЯЗАТЕЛЬНО: Сгенерируйте через UI после первого запуска и вставьте сюда
    AGENT_API_KEY=your_generated_agent_api_key

    # ОБЯЗАТЕЛЬНО: Укажите правильный URL сервера для агента
    # Зависит от сетевого режима агента в docker-compose.yml:
    # - network_mode: host -> http://127.0.0.1:8000 (или IP хоста)
    # - network: securenet_network -> http://server:8000
    AGENT_SERVER_URL=http://server:8000

    # Опционально: CIDR сети для агента (переопределяется конфигом с сервера)
    AGENT_NETWORK_CIDR=192.168.1.0/24
    ```
    *   **Замените** `YourStrongPasswordHere` и `your_generated_agent_api_key`.
    *   **Настройте** `AGENT_SERVER_URL` в соответствии с выбранным сетевым режимом агента в `docker-compose.yml`.
    *   Остальные переменные (PostgreSQL, Port) можно оставить как есть, если устраивают значения по умолчанию из `docker-compose.yml`.

    **Пример содержимого файла `server/.env` (внутри папки `server/`):**

    ```dotenv
    # server/.env (для приложения сервера)

    # Данные для подключения к БД в Docker Compose
    # Хост 'db' - это имя сервиса PostgreSQL в docker-compose.yml
    # Пользователь/пароль/имя_бд должны совпадать с переменными из корневого .env или значениями по умолчанию
    DATABASE_URL=postgresql+psycopg2://securenet_user:YourStrongPasswordHere@db:5432/securenet_db

    # КРИТИЧНО: Сгенерируйте надежный случайный секретный ключ
    # Используйте в терминале: python -c 'import secrets; print(secrets.token_hex(32))'
    SECRET_KEY=your_strong_random_secret_key_here_generated_via_terminal
    ```
    *   **Убедитесь**, что пользователь (`securenet_user`), пароль (`YourStrongPasswordHere`), имя БД (`securenet_db`) в `DATABASE_URL` **совпадают** со значениями из *корневого* файла `.env` (или значениями по умолчанию, если вы их там не переопределяли). Имя хоста должно быть `db`.
    *   **Обязательно** сгенерируйте и вставьте надежный `SECRET_KEY`.

3.  **(Опционально) Изменить Учетные Данные БД и Порт Сервера:**
    Лучший способ изменить учетные данные БД или порт сервера - это отредактировать переменные `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`, `SERVER_PORT` в **корневом файле `.env`**. Не забудьте также обновить строку `DATABASE_URL` в файле `server/.env`, чтобы она соответствовала новым учетным данным БД.

### Запуск с Docker Compose

1.  **Сборка и Запуск Сервисов (БД и Сервер):**
    Откройте терминал в *корневой* директории проекта (`SecureNet/`) и выполните:
    ```bash
    docker-compose up --build -d db server
    ```
    *   `--build`: Собрать Docker-образы перед запуском.
    *   `-d`: Запустить контейнеры в фоновом (detached) режиме.

2.  **Инициализация (Первый запуск):**
    *   **Подождите немного**, пока база данных запустится. Проверить статус: `docker-compose ps`. Сервис `db` должен быть `healthy`.
    *   **Инициализировать базу данных:**
        ```bash
        docker-compose run --rm server python manage.py init-db
        ```
    *   **Создать администратора:**
        ```bash
        docker-compose run --rm server python manage.py create-admin
        ```
        (Следуйте инструкциям в консоли для ввода имени пользователя и пароля).
    *   **Загрузить OUI базу:**
        ```bash
        docker-compose run --rm server python manage.py update-oui
        ```

3.  **Доступ к Веб-Интерфейсу:**
    Откройте браузер и перейдите по адресу `http://localhost:8000` (или порт, который вы указали в переменной окружения `SERVER_PORT` в *корневом* `.env`, если вы ее установили). Войдите, используя учетные данные администратора, созданные на предыдущем шаге.

4.  **Запуск Агента Scapy (Варианты):**

    *   **Вариант 1: Через Docker Compose (если настроено):**
        *   Добавьте агента через веб-интерфейс (`http://localhost:8000/agents`) и **скопируйте API ключ**.
        *   Раскомментируйте сервис `agent` в файле `docker-compose.yml`.
        *   **Добавьте или измените** переменные `AGENT_API_KEY`, `AGENT_SERVER_URL`, и `AGENT_NETWORK_CIDR` (опционально) в **корневом файле `.env`** (рядом с `docker-compose.yml`). Убедитесь, что `AGENT_SERVER_URL` указан корректно для вашей сетевой конфигурации!
        *   Перезапустите Docker Compose:
            ```bash
            # Если используется network_mode: host или cap_add, может потребоваться sudo
            sudo docker-compose up --build -d
            ```
        *   Проверьте логи агента: `docker-compose logs -f agent`
        *   **Примечание:** `network_mode: "host"` позволяет агенту видеть локальную сеть хоста, но требует запуска `docker-compose` с `sudo`. Альтернативные настройки сети (использование `securenet_network` и `cap_add`) более изолированы, но могут не позволить сканировать вашу основную LAN без дополнительных настроек маршрутизации Docker. `AGENT_SERVER_URL` должен быть `http://server:8000` для сети `securenet_network` или `http://127.0.0.1:8000` (или IP хоста) для `network_mode: host`.

    *   **Вариант 2: Отдельно через `docker run` (Рекомендуется для гибкости):**
        *   Добавьте агента через веб-интерфейс (`http://localhost:8000/agents`) и **скопируйте API ключ**.
        *   Соберите образ агента (если еще не собран через `docker-compose up`):
            ```bash
            docker build -t securenet-agent -f agent/Dockerfile .
            ```
        *   Запустите контейнер агента (замените `<ВАШ_API_КЛЮЧ>`, `<URL_СЕРВЕРА>` и `<NETWORK_CIDR>`):
            ```bash
            # Используем network_mode: host для сканирования сети хоста
            # Требует sudo! Укажите URL сервера как http://127.0.0.1:8000 или IP хоста
            sudo docker run --rm -it --network host \
              securenet-agent "<ВАШ_API_КЛЮЧ>" "http://127.0.0.1:8000" "<NETWORK_CIDR>"

            # --- ИЛИ ---
            # Запуск с подключением к сети Docker Compose и capabilities
            # (может не сканировать LAN хоста, URL сервера должен быть http://server:8000)
            # sudo docker run --rm -it --network securenet_securenet_network \
            #   --cap-add NET_RAW --cap-add NET_ADMIN \
            #   securenet-agent "<ВАШ_API_КЛЮЧ>" "http://server:8000" "<NETWORK_CIDR>"
            ```
        *   `--rm`: Удалить контейнер после остановки.
        *   `-it`: Интерактивный режим, чтобы видеть вывод агента и остановить его по Ctrl+C.
        *   `--network host`: Позволяет контейнеру использовать сетевой стек хоста. **Необходимо для простого сканирования LAN хоста.** Требует `sudo`.
        *   `securenet-agent`: Имя собранного образа.
        *   `<ВАШ_API_КЛЮЧ>`, `<URL_СЕРВЕРА>` и `<NETWORK_CIDR>`: Аргументы, передаваемые скрипту `scapy_agent.py`. `<URL_СЕРВЕРА>` обязателен, `<NETWORK_CIDR>` не обязателен.

5.  **Остановка Приложения:**
    ```bash
    docker-compose down
    ```
    Эта команда остановит и удалит контейнеры сервера и БД.

6.  **Удаление Данных БД (Осторожно!):**
    Если вы хотите удалить и том (volume) с данными PostgreSQL, используйте:
    ```bash
    docker-compose down -v
    ```

### Разработка с Docker

Файл `docker-compose.yml` настроен с монтированием томов для директории `server/` и файла `manage.py`. В сочетании с командой `uvicorn ... --reload` в сервисе `server`, это позволяет вам изменять код сервера на вашем хосте, и Uvicorn внутри контейнера будет автоматически перезапускаться, применяя изменения без необходимости пересборки образа.

---

## Использование (Общее)

*   **Вход:** Откройте веб-интерфейс (`http://localhost:8000` при использовании Docker или `http://<IP_адрес_сервера>:8000` при ручном запуске) и войдите, используя учетные данные администратора.
*   **Агенты:** Просмотр статуса агентов, добавление новых (для генерации API ключей), удаление агентов.
*   **Устройства:** Просмотр устройств, обнаруженных активными агентами. Есть вкладки "Активные" (недавно виденные) и "Все". Устройства изначально помечаются как "недоверенные" (`untrusted`). Вы можете изменить статус на `trusted` (доверенное) или `blocked` (заблокированное), добавить заметки/имя через кнопку редактирования (иконка карандаша). Заблокированные устройства будут генерировать оповещения при повторном обнаружении. Можно удалять устройства из списка (иконка корзины).
*   **Оповещения:** Просмотр уведомлений о новых устройствах, обнаружении заблокированных/недоверенных устройств и изменениях статуса агентов.
*   **Аналитика:** Просмотр графиков активности сети и оповещений за последние 6, 12 или 24 часа.
*   **Настройки:** Конфигурация различных системных параметров, настроек уведомлений, Telegram, Email (требуются права администратора). Можно вручную запустить обновление базы данных OUI или изменить URL для ее загрузки.

## Конфигурация (Общее)

*   **Сервер:**
    *   Базовая конфигурация (БД, секретный ключ) выполняется через файл `server/.env`.
    *   Операционные параметры (таймауты, интервалы, настройки уведомлений, URL OUI и т.д.) настраиваются на странице "Настройки" в веб-интерфейсе.
*   **Агенты (Scapy):**
    *   **URL сервера** (`BASE_SERVER_URL`) и **API ключ** (`AGENT_API_KEY`) **передаются как аргументы командной строки** при запуске агента (или через переменные окружения и `command` в `docker-compose.yml`).
    *   Остальная конфигурация (интервал сканирования, таймаут ARP, сеть CIDR) получается с сервера через API (`/api/agent/config`) используя базовый URL, переданный при запуске. Агент периодически проверяет обновления этой конфигурации.
*   **Docker Compose:** Переменные окружения для подстановки в `docker-compose.yml` (учетные данные БД, порт сервера, конфигурация агента) задаются в **корневом файле `.env`**.

## Решение Проблем

*   **Проблемы с подключением к БД (Docker):**
    *   Убедитесь, что сервис `db` в `docker-compose` запущен и `healthy` (`docker-compose ps`).
    *   Проверьте, что `DATABASE_URL` в `server/.env` использует хост `db` и правильные порт, пользователя, пароль и имя БД, совпадающие с настройками, используемыми сервисом `db` (из корневого `.env` или `docker-compose.yml`).
    *   Проверьте логи сервиса `db`: `docker-compose logs db`.
*   **Проблемы с подключением к БД (Ручная установка):** Убедитесь, что `DATABASE_URL` в `server/.env` указан верно, сервер БД запущен и доступен с машины, где работает SecureNet сервер. Убедитесь, что установлен правильный драйвер БД (`psycopg2-binary` для PostgreSQL). Проверьте логи сервера на ошибки SQLAlchemy.
*   **Права доступа Агента Scapy (Docker):**
    *   При использовании `network_mode: host` запускайте `docker run` или `docker-compose up` с `sudo`.
    *   При использовании `cap_add`: Убедитесь, что добавлены `NET_RAW` и `NET_ADMIN`. В некоторых системах может потребоваться отключение AppArmor (`security_opt: - apparmor:unconfined`). Сканирование LAN хоста может не работать в этом режиме без доп. настроек.
*   **Права доступа Агента Scapy (Ручная установка):** Если агент `scapy_agent.py` завершается с ошибками прав доступа ("Operation not permitted", "permission denied"), убедитесь, что вы запускаете его с `sudo` (Linux/macOS) или от имени Администратора (Windows). Убедитесь, что `libpcap` (Linux/macOS) или `Npcap` (Windows, с режимом совместимости WinPcap) установлен корректно.
*   **Ошибка Загрузки OUI:**
    *   Проверьте логи сервера (консольный вывод `uvicorn` или `docker-compose logs server`).
    *   Убедитесь, что контейнер `server` (или хост при ручном запуске) имеет доступ в Интернет и может достичь URL, указанного в настройках OUI (`ouiFileUrl`). Прокси или брандмауэры могут мешать.
    *   Убедитесь, что у процесса сервера есть права на запись в папку `server/data/` (или в `/app/server/data` внутри контейнера, что должно работать с volume mount).
*   **Ошибки Аутентификации (Веб-интерфейс):** Убедитесь, что `SECRET_KEY` в `server/.env` установлен правильно и не изменялся с момента последнего успешного входа. Попробуйте очистить cookie для сайта в браузере.
*   **Ошибки Аутентификации (Агент):**
    *   Перепроверьте, что API ключ (`X-API-Key`), переданный агенту **при запуске** (через аргумент командной строки или переменную `AGENT_API_KEY` и `command` в Docker Compose), точно совпадает с ключом из веб-интерфейса.
    *   Проверьте логи *сервера* (`docker-compose logs server` или вывод uvicorn) на сообщения об ошибках "Invalid or missing API key" или "Agent not found for the provided API key".
    *   Проверьте логи *агента* (вывод `python scapy_agent.py` или `docker-compose logs agent`) на наличие HTTP ошибок 401 или 404 при отправке отчета или запросе конфигурации.
*   **Агент Неактивен (статус `inactive` в UI):**
    *   Убедитесь, что скрипт/контейнер агента запущен.
    *   Проверьте логи *агента* на ошибки подключения к серверу. Убедитесь, что **URL сервера (`BASE_SERVER_URL`), переданный агенту при запуске**, правильно указывает на IP-адрес или имя хоста сервера SecureNet, доступный с машины/контейнера агента.
        *   При ручном запуске: проверьте второй аргумент команды `python scapy_agent.py ...`.
        *   При запуске через `docker-compose` (сервис `agent`): проверьте значение переменной `AGENT_SERVER_URL` в **корневом `.env`** и убедитесь, что оно корректно для выбранного `network_mode` (например, `http://server:8000` или `http://127.0.0.1:8000`).
        *   При запуске через `docker run`: проверьте второй аргумент команды `docker run ...`.
    *   Проверьте настройку "Тайм-аут неактивности агента" (`responseTimeout`) в веб-интерфейсе.
    *   Убедитесь, что агент успешно проходит аутентификацию (см. Ошибки Аутентификации (Агент)).
*   **Агент не получает конфигурацию:**
    *   См. пункт "Агент Неактивен". Проверьте **URL сервера, переданный агенту при запуске**, и API ключ.
    *   Убедитесь, что API эндпоинт `<URL_СЕРВЕРА>/api/agent/config` доступен и работает на сервере.
    *   Проверьте логи сервера и агента на ошибки при запросе конфигурации.
*   **Общие советы:** Всегда проверяйте консольный вывод (логи) как сервера (`uvicorn` или `docker-compose logs server`), так и агента (`python ..._agent.py` или `docker-compose logs agent` / `docker logs <agent_container_id>`) для получения детальной информации об ошибках.
